name: Real Android Browser Build (v7 - Docker)

on:
  workflow_dispatch:

jobs:
  build-in-docker:
    runs-on: ubuntu-latest
    container:
      # Chromium için hazırlanmış özel bir Docker İmajı kullanıyoruz (Devasa zaman/yer kazancı!)
      image: docker://shaseley/chromium-build:latest
      options: --user root

    steps:
    - uses: actions/checkout@v3

    # 1. Disk Temizliğine GEREK YOK (Docker kendi evini getiriyor)
    
    # 2. Kaynak Kodu Çek (Shallow - Sadece Android)
    - name: Fetch Source (In Docker)
      run: |
        mkdir chromium
        cd chromium
        fetch --nohooks --no-history android
        gclient sync --nohooks --no-history --shallow

    # 3. Bağımlılıklar (Zaten İmajda Var - Hızlı Geçiş)
    - name: Install Deps (Minimal)
      run: |
        cd chromium/src
        ./build/install-build-deps-android.sh --no-prompt --no-arm --no-chromeos-fonts --no-nacl
        gclient runhooks

    # 4. Derleme
    - name: Compile
      run: |
        cd chromium/src
        gn gen out/Default --args='target_os="android" target_cpu="arm64" is_debug=false symbol_level=0'
        autoninja -C out/Default system_webview_apk

    # 5. Yükle
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: DockerWebView
        path: chromium/src/out/Default/apks/SystemWebView.apk
