name: Real Android Browser Build

on:
  workflow_dispatch:

jobs:
  build-chromium:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 6 Saat Zaman Sınırı

    steps:
    - uses: actions/checkout@v3

    # 1. Disk Temizliği (Chromium için yer açma)
    - name: Free Disk Space
      run: |
        echo "Gereksiz dosyalar temizleniyor..."
        sudo rm -rf /usr/share/dotnet
        sudo rm -rf /usr/local/lib/android
        sudo rm -rf /opt/ghc
        sudo docker image prune --all --force

    # 2. Araçların Kurulumu
    - name: Install depot_tools
      run: |
        git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "$PWD/depot_tools" >> $GITHUB_PATH

    # 3. Kaynak Kod (Sadece Android ve Geçmişsiz - Hız için)
    - name: Fetch Chromium Source
      run: |
        mkdir chromium
        cd chromium
        fetch --no-history --nohooks android
      env:
        DEPOT_TOOLS_UPDATE: 0

    # 4. Bağımlılıklar
    - name: Install Deps
      run: |
        cd chromium/src
        ./build/install-build-deps-android.sh --no-prompt
        gclient runhooks

    # 5. Yamalar ve Ayarlar
    - name: Configure
      run: |
        echo "Ayarlar yapılıyor..."
        # Burada senin args.gn ve patch dosyalarını uygulayacağız
        # Şimdilik standart derlemeyi test ediyoruz

    # 6. DERLEME (Webview APK - Daha hızlı test için)
    - name: Compile SystemWebView
      run: |
        cd chromium/src
        gn gen out/Default --args='target_os="android" target_cpu="arm64" is_debug=false'
        autoninja -C out/Default system_webview_apk

    # 7. Sonucu Yükle
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: SystemWebView
        path: chromium/src/out/Default/apks/SystemWebView.apk
